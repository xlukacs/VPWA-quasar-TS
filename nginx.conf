server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    # Inject portfolio banner into every HTML response
    sub_filter '</body>' '
        <div id="portfolio-banner" style="
            position:fixed;top:0;left:0;width:100%;z-index:99999;
            background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);
            color:#e2e8f0;padding:14px 24px;
            font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;
            font-size:14px;display:flex;align-items:center;justify-content:center;gap:12px;
            box-shadow:0 2px 12px rgba(0,0,0,0.4);border-bottom:2px solid #e94560;
        ">
            <span style="font-size:18px;">&#128274;</span>
            <span>
                <strong style="color:#e94560;">Portfolio Showcase</strong>
                &mdash; This is a project demo. Login and registration are disabled.
            </span>
        </div>
        <style>
            #q-app, #app { padding-top: 52px !important; }
        </style>
    </body>';
    sub_filter_once on;
    sub_filter_types text/html;

    # Socket.io WebSocket + polling (must be before /api/)
    location /socket.io/ {
        proxy_pass http://localhost:3333/socket.io/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 86400s;
        proxy_send_timeout 86400s;
    }

    # API requests
    location /api/ {
        proxy_pass http://localhost:3333/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Serve frontend for all other routes
    location / {
        try_files $uri $uri/ /index.html;
    }
}